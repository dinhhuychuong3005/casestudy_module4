<!DOCTYPE html>
<html lang="en">
<head>
    <!--    hongdiem290695@gmail.com-->
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        function showFormLogin() {
            let str = `<input type="text" id="username" placeholder="Username">
                <br/>
                <input type="password" id="password" placeholder="Password">
                    <br/>
                    <button onclick="login()">Login</button>
 <br/>
                    <button onclick="showFormSignUp()">Đăng kí</button>`
            document.getElementById("form").innerHTML = str;
        }

        function showFormSignUp() {
            let str = "";
            str += "<table class='table table-dark table-striped'>\n" +
                "<tr>\n" +
                "<td>User name</td>\n" +
                "<td><input type='text' id='userName'></td>\n" +
                "</tr>\n" +
                "<tr>\n" +
                "<td>Password:</td>\n" +
                "<td><input type='text' id='password'></td>\n" +
                "</tr>\n" +
                "<tr>\n" +
                "<td>Full name</td>\n" +
                "<td><input type='text' id='fullName'></td>\n" +
                "</tr>\n" +
                "<tr>\n" +
                "<td>Email</td>\n" +
                "<td><input type='text' id='email'></td>\n" +
                "</tr>\n" +
                "<tr>\n" +
                "<td>Gender: </td>\n" +
                "<td><input type='text' id='gender'></td>\n" +
                "</tr>\n" +
                "<tr>\n" +
                "<td></td>\n" +
                "<td><button type='button' onclick='signUp()'>Save</td>\n" +
                "</tr>\n";
            document.getElementById("form").innerHTML = str;
        }

        function signUp() {
            let userName = $('#userName').val();
            let password = $('#password').val();
            let fullName = $('#fullName').val();
            let email = $('#email').val();
            let gender = $('#gender').val();
            let user = {
                username: userName,
                password: password,
                fullName: fullName,
                gender: gender,
                email: email,
                roles: [{
                        id: 1
                    }]
            }
            console.log(user)
            $.ajax({
                headers: {
                    'Accept': 'application/json',
                    'Content-type': 'application/json'
                },
                type: "POST",
                    data: JSON.stringify(user),
                url: "http://localhost:8080/api/register",

                success: function () {
                    console.log("A")
                    showFormLogin()
                    sendEmail(email)
                },
                error: function (error) {
                    console.log(error)
                }
            })
        }

        function login() {
            let username = $("#username").val();
            let password = $("#password").val();
            let user = {
                "username": username,
                "password": password
            }
            $.ajax({
                headers: {
                    'Accept': 'application/json',
                    'Content-type': 'application/json'
                },
                type: "POST",
                url: "http://localhost:8080/api/login",
                data: JSON.stringify(user),
                success: function (data) {
                    console.log(data);
                    console.log(data.accessToken)
                    localStorage.setItem('token', data.accessToken)
                    showList(data.accessToken)
                }
            })
        }

        function sendEmail(email) {
            $.ajax({
                type: "POST",
                url: "http://localhost:8080/api/sendEmail/" + email,
                success: console.log("ok")
            })
        }

        function showList(token) {
            $.ajax({
                type: "GET",
                url: "http://localhost:8080/api/",
                headers: {"Authorization": 'Bearer ' + token},
                success: function (data) {
                    let str = "<button type='button' onclick='showCreateForm()'>Create</button>\n" +
                        "<h1 style='margin-left: 30%'>List Product</h1>" +
                        "<table class='table table-dark table-striped'>\n" + "<tr>\n" +
                        "<th>username</th>\n" +
                        "<th>password</th>\n" +
                        "<th>fullname</th>\n" +
                        "<th>address</th>\n" +
                        "<th>Avatar</th>\n" +
                        "</tr>\n";
                    for (let i = 0; i < data.length; i++) {
                        str += "<tr><td>" + data[i].username;
                        str += "</td><td>" + data[i].password;
                        str += "</td><td>" + data[i].fullName;
                        str += "</td><td>" + data[i].address;
                        str += "</td><td>" + "<img width='80px' height='40px' src='" + data[i].avatar + "'/>"
                        console.log(data[i].avatar)
                        str += "</td>"
                    }
                    str += "</table>\n";
                    document.getElementById("form").innerHTML = str;
                },
            });
        }
    </script>
</head>
<body onload="showFormLogin()">
<div id="form"></div>
</body>
</html>